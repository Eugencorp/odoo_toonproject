<odoo>
  <data>

    <record model="ir.ui.view" id="cartoon_form_view">
        <field name="name">cartoon.form</field>
        <field name="model">toonproject.cartoon</field>
        <field name="arch" type="xml">
            <form string="Project Form">
                <sheet>
                    <group>
                        <field name="name" string="Проект"/>                    
                        <field name="parent_id" string="Родительский проект"/>
                        <field colspan="2" name="description" string="Описание"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="price_form_view">
        <field name="name">price.form</field>
        <field name="model">toonproject.price</field>
        <field name="arch" type="xml">
            <form string="Price Form">
                <sheet>
                    <group>
                        <field name="project_id" string="Проект"/>
                        <field name="tasktype_id" string="Процесс"/>
                        <field name="value" string="Стоимость"/>
                        <field name="next_tasktype" string="Следующий процесс"/>
                        <field name="precontroler_id" string="предварительный контроль" attrs="{'invisible':[('controler_id','=',None)]}"/>
                        <field name="controler_id" string="контроль" />
                        <field name="valid_group" string="Группа исполнителей"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="asset_form_view">
        <field name="name">asset.form</field>
        <field name="model">toonproject.asset</field>
        <field name="arch" type="xml">
            <form string="Asset Form">
                <sheet>
                    <group>
                        <group>
                            <field name="project_id" string="Проект: "/>
                            <field name="name" string="Название"/>
                            <field name="assettype_id" string="Тип:"/>
                            <field name="short_description" string="Краткое описание:"/>
                            <field name="size" string="Размер:"/>
                        </group>
                        <group>
                          <group colspan="2">
                            <field name="description" string="Длинное описание:"/>
                            <field name="factor" string="Ориентировочная сложность"/>
                          </group>
                            <group>
                                <field name="icon_image" widget="image"/>
                            </group>
                            <group>
                                <field colspan="2" name="icon_video" widget="image"/>
                                <field colspan="2" name="icon_video_url" />
                            </group>                            
                        </group>
                    </group>
                    <label for="task_ids"/>
                    <field name="task_ids">
                      <tree class="no_open">
                        <button name="open_task_view_py" string="смотреть" type="object"/>
                        <field name="name" string="задача"/>
                        <field name="tasktype_id" string="вид работ"/>
                        <field name="worker_id" string="исполнитель"/>
                        <field name="status" string="статус"/>
                      </tree>
                    </field>
                  <script>
                      jQuery('.no_open .o_data_row td').click(function(evt) { evt.stopPropagation(); });
                  </script>
                </sheet>
            </form>
        </field>
    </record>
    
    <record model="ir.ui.view" id="tasks_form_view">
        <field name="name">task.form</field>
        <field name="model">toonproject.task</field>
        <field name="arch" type="xml">
            <form string="Task Form">
                <sheet>
                    <notebook>
                        <page string="Задание">
                          <group>
                            <field name="name" string="Задание" attrs="{'readonly':[('isManager','=',False)]}" />
                            <field name="project_id" string="по проекту" attrs="{'readonly':[('isManager','=',False)]}" />
                            <field name="tasktype_id" string="Тип работ:" attrs="{'readonly':[('isManager','=',False)]}"/>
                            <field name="worker_id" string="Исполнитель:" attrs="{'readonly':[('isManager','=',False)]}"/>
                            <field name="status" string="Статус:" attrs="{'readonly':[('isManager','=',False)]}"/>
                          </group>
                        </page>
                        <page string="Описание">
                          <group>
                            <field name="description" string="Описание задачи:" attrs="{'readonly':[('isManager','=',False)]}"/>
						                <field name="factor" string="Сложность:" attrs="{'readonly':[('isManager','=',False)]}"/>
                            <field name="computed_price" string="Cтоимость:"/>
						                <field name="compute_price_method" string="Способ рассчета стоимости:" groups="toonproject.group_toonproject_manager,toonproject.group_toonproject_admin"/>
                          </group>
                        </page>
                        <page string="Контроль">
                          <group>
                            <field name="precontroler_id" string="Предварительный контроль:" attrs="{'invisible':['|',('controler_id','=',None), '&amp;', ('isManager','=',False), ('precontroler_id','=',None)],'readonly':[('isManager','=',False)]}"/>
                            <field name="controler_id" string="Контролер:" attrs="{'readonly':[('isManager','=',False)]}"/>
                          </group>
                        </page>
                        <page string="Сроки">
                          <group>
                            <field name="valid_group" string="Кому можно выдавать" attrs="{'invisible':[('worker_id','!=',None)],'readonly':[('isManager','=',False)]}"/>
                            <field name="work_start" string="принято в работу:" widget="date" attrs="{'readonly':[('isManager','=',False)]}"/>
                            <field name="plan_finish" string="планируемое окончание:" widget="date" attrs="{'readonly':[('isManager','=',False),'|',('plan_finish','!=',None),('isWorker','=',False)]}"/>
                            <field name="real_finish" string="фактическое окончание:" widget="date" attrs="{'readonly':[('isManager','=',False)], 'invisible':[('status','!=','finished'),('isManager','=',False)]}" />
                          </group>
                        </page>
                        <page string="Результат">
                          <group>
                          </group>
                        </page>
                        <page string="Служебное">
                          <group>
                            <field name="isManager" string="Manager" invisible="1"/>
                            <field name="isControler" invisible="1"/>
                            <field name="isWorker" invisible="1"/>
                            <field name="isValidWorker" invisible="1"/>
                            <field name="current_control" string="current_control" invisible="1"/>
                          </group>
                        </page>
                    </notebook>
                    <script>
                      jQuery('td.o_td_label+td').each(function(i,el){el.style.width = null;});
                      jQuery('table.o_group').each(function(i,el){el.style.width = 'auto';});
                    </script>
                    <group col="3">
                      <div>
                        <label for="asset_ids"/>
                        <field name="asset_ids" widget="clickable_tags" options="{'help_title':'Hello,world!'}" attrs="{'readonly':[('isManager','=',False)]}"/>
                        <!--<field name="asset_ids" attrs="{'readonly':[('isManager','=',False)]}">
                          <tree>
                            <field name="assettype_id"/>
                            <field name="name"/>
                            <field name="short_description"/>
                            <field name="size"/>
                          </tree>
                        </field>-->
                      </div>
                      <div>
                        <label for="affecting_tasks"/>
                          <field name="affecting_tasks" widget="many2many_tags" attrs="{'readonly':[('isManager','=',False)]}"/>
                          <!--
                          <field name="affecting_tasks" attrs="{'readonly':[('isManager','=',False)]}">
                                <tree>
                                  <field name="name"/>
                                  <field name="tasktype_id"/>
                                  <field name="status"/>
                                  <field name="worker_id"/>
                                </tree>
                          </field>
                          -->
                      </div>
                      <div>
                        <label for="dependent_tasks"/>
                        <field name="dependent_tasks" attrs="{'readonly':[('isManager','=',False)]}">
                              <tree>
                                <field name="name"/>
                                <field name="tasktype_id"/>
                              </tree>
                        </field>
                      </div>
                    </group>
                    <group>
                        <button name="button_start" string="взять в работу" type="object" attrs="{'invisible':['|',('status','!=', 'ready'),('isValidWorker','!=',True)]}" class="btn-success"/>
                        <button name="button_control" string="отправить в проверку" type="object" attrs="{'invisible':['|',('status','!=', 'progress'),('isWorker','!=',True)]}" class="btn-danger"/>
                        <button name="button_reject" string="вернуть на доработку" type="object" attrs="{'invisible':['|',('status','!=', 'control'),('isControler','!=',True)]}" class="btn-danger"/>
                        <button name="button_accept" string="принять" type="object" attrs="{'invisible':['|',('status','!=', 'control'),('isControler','!=',True)]}" class="btn-success"/>
                    </group>

                    <div class = "oe_chatter" style="display:block;">
                         <field name="message_follower_ids" widget="mail_followers"/>
                         <field name="message_ids" widget="mail_thread"/>
                    </div>

                </sheet>
            </form>
        </field>
    </record>
	
    <record model="ir.ui.view" id="tasktype_form_view">
        <field name="name">tasktype.form</field>
        <field name="model">toonproject.tasktype</field>
        <field name="arch" type="xml">
            <form string="Asset Form">
                <sheet>
					<field name="name" />
					<field name="description" />
					<field name="valid_assettypes" widget="many2many_checkboxes"  string="Применимо к" />
				</sheet>
			</form>
		</field>
	</record>

    <record model="ir.ui.view" id="cartoon_list">
      <field name="name">cartoon.list</field>
      <field name="model">toonproject.cartoon</field>
      <field name="arch" type="xml">
        <tree>
          <field name="name" string="проект"/>
          <field name="description" string="описание"/>
          <field name="parent_id" string="родительский проект"/>
        </tree>
      </field>
    </record>  

    <record model="ir.ui.view" id="asset_list">
      <field name="name">asset.list</field>
      <field name="model">toonproject.asset</field>
      <field name="arch" type="xml">
        <tree>
          <field name="assettype_id" string="тип"/>
          <field name="name" string="название"/>
          <field name="short_description" string="краткое описание:"/>
          <field name="size" string="размер" sum="общий размер"/>
        </tree>
      </field>
    </record>
    
    <record model="ir.ui.view" id="task_list">
      <field name="name">task.list</field>
      <field name="model">toonproject.task</field>
      <field name="arch" type="xml">
        <tree>
          <field name="project_id" string="проект"/>
          <field name="name" string="задача"/>
          <field name="asset_ids" string="объект"  widget="many2many_tags"/>
          <field name="tasktype_id" string="вид работ"/>
          <field name="factor" string="сложность"/>
          <field name="status" string="статус"/>          
          <field name="worker_id" string="исполнитель"/>
          <field name="work_start" string="начата"/>
          <field name="real_finish" string="закончена"/>
          <field name="write_date" string="последние изменения"/>
          <field name="computed_price" string="стоимость" sum="сумма:"/>
          <field name="pay_date" string="оплачено"/>
        </tree>
      </field>
    </record> 

    <record model="ir.ui.view" id="price_list">
      <field name="name">price.list</field>
      <field name="model">toonproject.price</field>
      <field name="arch" type="xml">
        <tree>
          <field name="project_id" string="проект"/>
          <field name="tasktype_id" string="вид работ"/>
          <field name="value" string="расценка"/>
          <field name="next_tasktype" string="следующий процесс"/>
          <field name="precontroler_id" string="предварительный контроль"/>
          <field name="controler_id" string="контроль"/>
          <field name="valid_group" string="группа работников"/>
        </tree>
      </field>
    </record> 	

    <record model="ir.actions.act_window" id="cartoons_list_action">
        <field name="name">Проекты</field>
        <field name="res_model">toonproject.cartoon</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Создайте первый проект
            </p>
        </field>
    </record>    

    <record model="ir.actions.act_window" id="assets_list_action">
        <field name="name">Материалы</field>
        <field name="res_model">toonproject.asset</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Создайте первую сцену, фон или риг
            </p>
        </field>
    </record>
    
    <record model="ir.actions.act_window" id="tasks_list_action">
        <field name="name">Задачи</field>
        <field name="res_model">toonproject.task</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Создайте первую задачу
            </p>
        </field>
    </record>

    <record model="ir.actions.act_window" id="prices_list_action">
        <field name="name">Расценки и пайплайн</field>
        <field name="res_model">toonproject.price</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Добавьте расценку на какой-нибудь вид работ
            </p>
        </field>
    </record>   
    
    <menuitem id="main_toonproject_menu" name="The Toon Project" sequence="0"/>
    <menuitem id="lists_menu" name="Списки" parent="main_toonproject_menu"/>
    <menuitem id="projects_menu" name="Проекты" parent="lists_menu"
                  action="cartoons_list_action"/>        
    <menuitem id="assets_menu" name="Материалы" parent="lists_menu"
                  action="assets_list_action"/>    
    <menuitem id="tasks_menu" name="Задачи" parent="lists_menu"
                  action="tasks_list_action"/> 
    <menuitem id="prices_menu" name="Расценки и пайплайн" parent="lists_menu"
                  action="prices_list_action"
                  groups="toonproject.group_toonproject_admin"/>

	<record model="ir.ui.view" id="createtasks_wizard_form_view">
		<field name="name">createtasks_wizard.form</field>
		<field name="model">toonproject.createtasks_wizard</field>
		<field name="arch" type="xml">
			<form string="Создать задачи">
				<group>
					<field name="asset_ids"/>
					<field name="tasktype_ids"  widget="many2many_checkboxes"/>
				</group>
				<footer>
					<button name="create_tasks" type="object"
							string="Создать" class="oe_highlight"/>
					or
					<button special="cancel" string="Отмена"/>
				</footer>
			</form>
		</field>
	</record>

	<act_window id="launch_createtasks_wizard"
				name="Создать задачи..."
				src_model="toonproject.asset"
				res_model="toonproject.createtasks_wizard"
				view_mode="form"
				target="new"
				key2="client_action_multi"/>

    <template id="assets_end" inherit_id="web.assets_backend">
        <xpath expr="." position="inside">
            <script src="/toonproject/static/src/js/widgets.js" type="text/javascript" />
        </xpath>
    </template>

  </data>
</odoo>
